(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n=function(){function n(e,r,o){var i=this,u=e.data,c=e.handleCardClick,a=e.handleLikeClick,s=e.handleDislikeClick,l=e.handleDeleteClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"_handleLike",(function(){i._content.querySelector(".element__button").classList.contains("element__button_active")?i._handleDislikeClick(i._id):i._handleLikeClick(i._id)})),t(this,"handleDelete",(function(){i._content.remove(),i._content=null})),this._name=u.name,this._link=u.link,this._likes=u.likes,this._id=u._id,this._owner=u.owner,this._handleCardClick=c,this._handleLikeClick=a,this._handleDislikeClick=s,this._handleDeleteClick=l,this._cardSelector=r,this._userId=o}var r,o;return r=n,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"inactivateDelete",value:function(){this._content.querySelector(".element__delete").classList.add("element__delete_inactive")}},{key:"handleToggleLike",value:function(e){var t=e.likes;this._content.querySelector(".element__button").classList.toggle("element__button_active"),this._content.querySelector(".element__likes").textContent=t.length}},{key:"_checkLikeState",value:function(){var e=this;this._likes.some((function(t){return t._id===e._userId}))&&this.handleToggleLike({likes:this._likes})}},{key:"_checkLikeOwner",value:function(){this._owner._id!==this._userId&&this.inactivateDelete()}},{key:"_setEventListeners",value:function(){this._elementImage.addEventListener("click",this._handleCardClick),this._content.querySelector(".element__button").addEventListener("click",this._handleLike),this._content.querySelector(".element__delete").addEventListener("click",this._handleDeleteClick)}},{key:"render",value:function(){return this._content=this._getTemplate(),this._elementImage=this._content.querySelector(".element__image"),this._elementImage.setAttribute("alt",this._name),this._elementImage.setAttribute("src",this._link),this._content.querySelector(".element__title").textContent=this._name,this._content.querySelector(".element__likes").textContent=this._likes.length,this._setEventListeners(),this._checkLikeOwner(),this._checkLikeState(),this._content}}])&&e(r.prototype,o),n}();function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parameters=t,this._form=document.querySelector(n),this._submitButton=this._form.querySelector(".popup__submit-button"),this._inputList=Array.from(this._form.querySelectorAll(".popup__input"))}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._form.querySelector("#".concat(e.id,"-error"));n.textContent=t,e.classList.add(this._parameters.inputErrorClass),n.classList.add(this._parameters.errorClass)}},{key:"_hideInputError",value:function(e){var t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent="",e.classList.remove(this._parameters.inputErrorClass),t.classList.remove(this._parameters.errorClass)}},{key:"_checkInputValidity",value:function(e){if(e.validity.valid)this._hideInputError(e);else{var t=e.validationMessage;this._showInputError(e,t)}}},{key:"_toggleButtonState",value:function(){this._checkInputsValidity()?(this._submitButton.classList.add(this._parameters.inactiveButtonClass),this._submitButton.setAttribute("disabled",!0)):(this._submitButton.classList.remove(this._parameters.inactiveButtonClass),this._submitButton.removeAttribute("disabled"))}},{key:"_checkInputsValidity",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))})),this._toggleButtonState()}},{key:"disableSubmitButton",value:function(){this._submitButton.setAttribute("disabled",!0),this._submitButton.classList.add("popup__submit-button_disabled")}},{key:"resetErrors",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&r(t.prototype,n),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_active"),document.addEventListener("keyup",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_active"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleCloseByOverlay",value:function(e){e.target==e.currentTarget&&this.close()}},{key:"setEventListeners",value:function(){this._popup.querySelector(".popup__button").addEventListener("click",this.close.bind(this)),this._popup.addEventListener("mousedown",this._handleCloseByOverlay.bind(this))}}])&&i(t.prototype,n),e}();function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(o){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return f(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._imageTitle=t._popup.querySelector(".popup-image__title"),t._popupWithImage=t._popup.querySelector(".popup-image__image"),t}return t=u,(n=[{key:"open",value:function(e){var t=e.name,n=e.link;this._imageTitle.textContent=t,this._popupWithImage.setAttribute("src",n),this._popupWithImage.setAttribute("alt",t),s(p(u.prototype),"open",this).call(this)}}])&&a(t.prototype,n),u}(u);function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=i.call(this,e))._handleSubmitForm=t,r._renderer=n,r._form=r._popup.querySelector(".popup__form"),r}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=Array.from(this._popup.querySelectorAll(".popup__input")),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;d(b(u.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._handleSubmitForm(e._getInputValues())}))}},{key:"close",value:function(){d(b(u.prototype),"close",this).call(this),this._form.reset()}},{key:"open",value:function(){this._renderer(this._form),d(b(u.prototype),"open",this).call(this)}}])&&y(t.prototype,n),u}(u);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=t,this._containerSelector=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){var n=t._renderer(e);t.addItem(n)}))}},{key:"addItem",value:function(e){this._containerSelector.prepend(e)}}])&&g(t.prototype,n),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n=t.profileNameSelector,r=t.profileDescriptionSelector,o=t.profileAvatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(n),this._profileDescription=document.querySelector(r),this._profileAvatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._profileName.textContent,about:this._profileDescription.textContent}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._profileName.textContent=t,this._profileDescription.textContent=n,this._profileAvatar.setAttribute("src",r)}},{key:"setUserAvatar",value:function(e){var t=e.avatar;this._profileAvatar.setAttribute("src",t)}}])&&w(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t,this._authorization=n}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._url,"cards"),{headers:{authorization:this._authorization}}).then((function(t){return e._checkResponse(t)}))}},{key:"changeUserInfo",value:function(e){var t=this,n=e.name,r=e.about;return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:r})}).then((function(e){return t._checkResponse(e)}))}},{key:"addNewCard",value:function(e){var t=this,n=e.name,r=e.link;return fetch("".concat(this._url,"cards"),{method:"POST",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:r})}).then((function(e){return t._checkResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:{authorization:this._authorization}}).then((function(e){return t._checkResponse(e)}))}},{key:"changeUserPhoto",value:function(e){var t=this,n=e.link;return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(e){return t._checkResponse(e)}))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._url,"users/me"),{headers:{authorization:this._authorization}}).then((function(t){return e._checkResponse(t)}))}},{key:"like",value:function(e){var t=this;return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:{authorization:this._authorization}}).then((function(e){return t._checkResponse(e)}))}},{key:"dislike",value:function(e){var t=this;return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:{authorization:this._authorization}}).then((function(e){return t._checkResponse(e)}))}},{key:"renderPage",value:function(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}}])&&E(t.prototype,n),e}();function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(r);if(o){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return I(this,e)});function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,e))._submitHandler=t,n}return t=u,(n=[{key:"setSubmitAction",value:function(e){this._submitHandler=e}},{key:"setEventListeners",value:function(){var e=this;j(R(u.prototype),"setEventListeners",this).call(this),this._popup.addEventListener("submit",(function(t){t.preventDefault(),e._submitHandler(),e.close()}))}}])&&q(t.prototype,n),u}(u),T=(Array.from(document.querySelectorAll(".popup")),".popup_add"),D=".popup_edit",B=".popup_change-photo",x=document.querySelector(D).querySelector('[name="name"]'),z=document.querySelector(D).querySelector('[name="about"]'),U=document.querySelector(".profile__photo-container"),V=document.querySelector(".profile__edit-button"),N=(document.querySelectorAll(".popup__button"),document.querySelector(".profile__add-button")),H=".popup__form_edit",J=".popup__form_add",W=".popup__form_change-photo",F=(document.querySelector(H),document.querySelector(J),document.querySelector(W),document.querySelector(".popup-image__close-button"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"});function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $,G=new C({profileNameSelector:".profile__name",profileDescriptionSelector:".profile__description",profileAvatarSelector:".profile__avatar"}),K=new h(".popup-image"),Q=new L("https://mesto.nomoreparties.co/v1/cohort-18/","992a3ad3-237d-4b2f-8424-0245e20d32b7");function X(e,t,n){document.querySelector(t).querySelector(F.submitButtonSelector).textContent=e?"Сохранение...":n}var Y=function(e){var t=new n({data:e,handleCardClick:function(){return K.open(e)},handleLikeClick:function(e){Q.like(e).then((function(e){return t.handleToggleLike(e)})).catch((function(e){return console.error(e)}))},handleDislikeClick:function(e){Q.dislike(e).then((function(e){return t.handleToggleLike(e)})).catch((function(e){return console.error(e)}))},handleDeleteClick:function(){ee.setSubmitAction((function(){Q.deleteCard(t._id).then((function(e){return t.handleDelete(t._id)})).catch((function(e){return console.error(e)}))})),ee.open()}},".template",$);return t.render()},Z=new S(Y,".elements__grid"),ee=new A(".popup_submit-form"),te=new k(T,(function(e){var t=document.querySelector(T).querySelector(F.submitButtonSelector).textContent;X(!0,T,t),Q.addNewCard(e).then((function(e){var t=Y(e);Z.addItem(t),te.close()})).catch((function(e){return console.error(e)})).finally((function(){X(!1,T,t)}))}),(function(){ie.resetErrors(),ie.disableSubmitButton()})),ne=new k(D,(function(e){var t=document.querySelector(D).querySelector(F.submitButtonSelector).textContent;X(!0,D,t),Q.changeUserInfo(e).then((function(e){G.setUserInfo(e),ne.close()})).catch((function(e){return console.error(e)})).finally((function(){X(!1,D,t)}))}),(function(){oe.resetErrors();var e=G.getUserInfo();x.value=e.name,z.value=e.about})),re=new k(B,(function(e){var t=document.querySelector(B).querySelector(F.submitButtonSelector).textContent;X(!0,B,t),Q.changeUserPhoto(e).then((function(e){G.setUserAvatar(e),re.close()})).catch((function(e){return console.error(e)})).finally((function(){X(!1,B,t)}))}),(function(){ue.resetErrors(),ue.disableSubmitButton(F.submitButtonSelector)})),oe=new o(F,H),ie=new o(F,J),ue=new o(F,W);Q.renderPage().then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var u,c=e[Symbol.iterator]();!(r=(u=c.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}}(t,n)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];$=i._id,Z.renderItems(o),G.setUserInfo(i)})).catch((function(e){return console.error(e)})),ue.enableValidation(),oe.enableValidation(),ie.enableValidation(),ne.setEventListeners(),re.setEventListeners(),te.setEventListeners(),V.addEventListener("click",ne.open.bind(ne)),N.addEventListener("click",te.open.bind(te)),U.addEventListener("click",re.open.bind(re)),K.setEventListeners(),ee.setEventListeners()})();